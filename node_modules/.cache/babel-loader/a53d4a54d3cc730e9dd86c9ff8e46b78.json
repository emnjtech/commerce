{"ast":null,"code":"var _jsxFileName = \"/Users/admin/ReactProjects/reactProject/my-app/src/context/commerce-state.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport { ADD_T0_CART, REMOVE_FROM_CART, INC_QTY, DEC_QTY, EMPTY_CART } from \"./commerce-action\";\nimport { useReducer, useEffect, useState } from \"react\";\nimport CommerceContext from \"./commerce-context\";\nimport { commerceReducer } from './commerce-reducer';\nimport { signInWithPopup, onAuthStateChanged, signOut } from 'firebase/auth';\nimport { auth, provider } from '../firebaseConfig';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst storageKey = \"localCart\";\nconst InitialState = {\n  basket: [] //id, title,price,image\n\n}; // add to cart\n\nexport default function CommerceState(props) {\n  _s();\n\n  const [state, dispatch] = useReducer(commerceReducer, InitialState, initial => JSON.parse(localStorage.getItem(storageKey)) || initial);\n  const [currUser, setCurrUser] = useState({});\n  const [userInfo, setUserInfo] = useState(\"\");\n  useEffect(() => {\n    const abortCont = new AbortController();\n    const unsubscribe = onAuthStateChanged(auth, currentuser => {\n      if (currentuser) {\n        setInterval(() => {\n          setCurrUser(currentuser, {\n            signal: abortCont.signal\n          });\n        }, 1500);\n      } else if (!user) {\n        setInterval(() => {\n          navigate('/signIn');\n        }, 1500);\n      }\n    });\n    unsubscribe();\n    return () => {\n      abortCont.abort();\n    };\n  }, []);\n\n  const signInWithGoogle = () => {\n    signInWithPopup(auth, provider).then(result => {\n      setUserInfo({\n        name: result.user.displayName,\n        email: result.user.email,\n        userPhotoUrl: result.user.photoURL\n      });\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n  /*useEffect(() => {\n      localStorage.setItem('USER_INFORMATION', JSON.stringify(userInfo));\n      console.log(userInfo)\n   }, [userInfo]);\n   useEffect(() => {\n      const data = localStorage.getItem('USER_INFORMATION');\n      if (data !== null) setUserInfo(JSON.parse(data));\n      console.log(data)\n  }, []);\n  */\n\n\n  const userLogout = () => {\n    return signOut(auth);\n  };\n\n  const incQty = itemID => {\n    dispatch({\n      type: INC_QTY,\n      payload: itemID\n    });\n  };\n\n  useEffect(() => {\n    localStorage.setItem(storageKey, JSON.stringify(state));\n  }, [state]);\n  const totalQty = state.basket.reduce((totalQty, item) => {\n    return totalQty + item.qty;\n  }, 0);\n  console.log(totalQty);\n\n  const decQty = itemID => {\n    dispatch({\n      type: DEC_QTY,\n      payload: itemID\n    });\n  };\n\n  const addToCart = item => {\n    dispatch({\n      type: ADD_T0_CART,\n      payload: item\n    });\n  };\n\n  const removeFromCart = itemId => {\n    dispatch({\n      type: REMOVE_FROM_CART,\n      payload: itemId\n    });\n  };\n\n  const emptyCart = () => {\n    dispatch({\n      type: EMPTY_CART\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(CommerceContext.Provider, {\n    value: {\n      basket: state.basket,\n      addToCart,\n      removeFromCart,\n      incQty,\n      decQty,\n      emptyCart,\n      totalQty,\n      currUser,\n      signInWithGoogle,\n      userLogout,\n      userInfo\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 127,\n    columnNumber: 7\n  }, this);\n}\n\n_s(CommerceState, \"OoxcaR9dtepWNX/QtXtQLCYWNtQ=\");\n\n_c = CommerceState;\n\nvar _c;\n\n$RefreshReg$(_c, \"CommerceState\");","map":{"version":3,"sources":["/Users/admin/ReactProjects/reactProject/my-app/src/context/commerce-state.js"],"names":["React","ADD_T0_CART","REMOVE_FROM_CART","INC_QTY","DEC_QTY","EMPTY_CART","useReducer","useEffect","useState","CommerceContext","commerceReducer","signInWithPopup","onAuthStateChanged","signOut","auth","provider","storageKey","InitialState","basket","CommerceState","props","state","dispatch","initial","JSON","parse","localStorage","getItem","currUser","setCurrUser","userInfo","setUserInfo","abortCont","AbortController","unsubscribe","currentuser","setInterval","signal","user","navigate","abort","signInWithGoogle","then","result","name","displayName","email","userPhotoUrl","photoURL","catch","error","console","log","userLogout","incQty","itemID","type","payload","setItem","stringify","totalQty","reduce","item","qty","decQty","addToCart","removeFromCart","itemId","emptyCart","children"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { ADD_T0_CART, REMOVE_FROM_CART, INC_QTY, DEC_QTY, EMPTY_CART, } from \"./commerce-action\";\nimport { useReducer, useEffect,useState} from \"react\";\nimport CommerceContext from \"./commerce-context\";\nimport {commerceReducer} from './commerce-reducer'\nimport { signInWithPopup, onAuthStateChanged, signOut } from 'firebase/auth'\nimport {auth,provider} from '../firebaseConfig'\n\nconst storageKey = \"localCart\";\n\nconst InitialState = {\n    basket: [], //id, title,price,image\n}\n\n\n// add to cart\n\n\n\nexport default function CommerceState(props) {\n    const [state, dispatch] = useReducer(commerceReducer, InitialState, (initial) => JSON.parse(localStorage.getItem(storageKey)) || initial)\n    const [currUser, setCurrUser] = useState({})\n    const [userInfo, setUserInfo] = useState(\"\")\n\n    useEffect(() => {\n        const abortCont = new AbortController();\n    \n        const unsubscribe = onAuthStateChanged(auth, (currentuser) => {\n            if (currentuser) {\n                setInterval(() => {\n                    setCurrUser(currentuser, { signal: abortCont.signal })\n                }, 1500)\n               \n            }\n            else if (!user) {\n                setInterval(() => {\n                    navigate('/signIn')\n\n                }, 1500)\n            }\n        })\n            unsubscribe()        \n        return () => {\n            abortCont.abort();\n        }\n    }, []) \n    \nconst signInWithGoogle = () => {\n        signInWithPopup(auth, provider)\n            .then((result) => {\n                setUserInfo({\n                    name: result.user.displayName,\n                    email: result.user.email,\n                userPhotoUrl: result.user.photoURL\n                })\n              \n            }).catch((error) => {\n                console.log(error)\n            })\n    }  \n\n    /*useEffect(() => {\n        localStorage.setItem('USER_INFORMATION', JSON.stringify(userInfo));\n        console.log(userInfo)\n\n    }, [userInfo]);\n\n    useEffect(() => {\n        const data = localStorage.getItem('USER_INFORMATION');\n        if (data !== null) setUserInfo(JSON.parse(data));\n        console.log(data)\n    }, []);\n    */\n\n\n    const userLogout = () => {\n        return signOut(auth)\n    }\n    const incQty = (itemID) => {\n        dispatch({\n            type: INC_QTY,\n            payload: itemID\n        })\n    }\n\n    useEffect(() => {\n        localStorage.setItem(storageKey, JSON.stringify(state));\n        \n    }, [state]);\n\n    const totalQty = state.basket.reduce((totalQty, item) => {\n        return totalQty + (item.qty)\n    }, 0)\n    console.log(totalQty)\n\n\n    const decQty = (itemID) => {\n        dispatch({\n            type: DEC_QTY,\n            payload:itemID\n            \n        })\n    }\n    const addToCart = (item) => {\n        dispatch({\n            type: ADD_T0_CART,\n            payload: item\n\n        })\n    }\n\n    const removeFromCart = (itemId) => {\n        dispatch({\n            type: REMOVE_FROM_CART,\n            payload: itemId\n        })\n    }\n\n    const emptyCart = () => {\n        dispatch({\n            type:EMPTY_CART\n        })\n    }\n\n  return (\n   \n      <CommerceContext.Provider value={{\n          basket: state.basket,\n          addToCart,\n          removeFromCart,\n          incQty,\n          decQty,\n          emptyCart,\n          totalQty,\n          currUser,\n          signInWithGoogle,\n          userLogout,\n          userInfo\n\n      }}>\n          {props.children}\n      </CommerceContext.Provider>\n      \n      \n      \n  )\n}\n"]},"metadata":{},"sourceType":"module"}